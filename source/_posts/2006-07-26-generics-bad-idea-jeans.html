---
layout: post
title: "Generics + Bad Idea Jeans"
date: 2006-07-26T21:36:00-07:00
---

<div class='post'>
<span style="color: rgb(51, 51, 255);font-size:180%;" >{</span><br /><br />I can't get the <a href="http://snltranscripts.jt.org/90/90abadidea.phtml">Bad Idea Jeans</a> SNL sketch out of my head, but I'm not sure I trust myself.  At the request of a coworker, I wrote the following to show how a generic Dictionary could be returned from a method with underlying types for key/value stated ahead of time:<br /><br /><div style="background-color: gray; color: white;"><br /><blockquote><br /><pre><br />public static Dictionary&lt;X, G&gt; BuildDictionary&lt;X, G&gt;(string cmd, string keyColumn, string valColumn) {<br /> Dictionary&lt;X, G&gt; myDictionary = new Dictionary&lt;X, G&gt;();<br /> SqlDataReader rd = new SqlCommand(cmd, GetConnection()).ExecuteReader();<br /> while (rd.Read()) {<br />  myDictionary.Add((X)rd[keyColumn], (G)rd[valColumn]); // ? good idea?<br /> }<br /> rd.Close();<br /> return myDictionary;<br />}<br /></pre><br /></blockquote><br /></div><br /><br />It leverages generics to define the returned dictionary so that a call could be made like this:<br /><br /><div style="background-color: gray; color: white;"><br /><blockquote><br /><pre><br />Dictionary&lt;int, int&gt; data = DBDictionary.BuildDictionary&lt;int, int&gt;("myproc", "key", "val");<br /></pre><br /></blockquote><br /></div><br /><br />Perhaps I'm paranoid, or I've been burned too much, or I'm not scared of a little type dynamism, but this seems like a Bad Idea.  The big reason, of course, is the casting that goes on in the method:<br /><br />myDictionary.Add((X)reader["someField"], (G)reader["someField"]);<br /><br />Reasons for my anxiety?<br />1. What if the underlying field has a change of type?  You won't know until runtime when things blow up.<br />2. Maintenance if underlying field type does, in fact, change.  If being type specific is avoided, you can gracefully accept these changes without a recompile.  Even if your lookup (what's in the dictionary) is used, if it's passed to a SqlCommand as a parameter (which is the way I normally do it), the reference it expects is to an object type as in:<br /><br />SqlParameter para = new SqlParameter("@Foo", objectRef);<br /><br />3. I'm not afraid of strings.  Over time I've been more reluctant to convert things, especially numbers.  For example, if a numeric value is passed in the querystring, like:<br /><br />http://myserv/Page.aspx?custId=101<br /><br />Why should we convert custId to a numer if it's going to be passed to a parameter (see code above)?  Another scenario is when some underlying value is going to end up in a textbox.  I do not fear the string, just the Convert.ToXXYYZZ code I'd have to type out if I did want to be "type safe."<br /><br />But some may feel differently, especially the ones who think that if something in the database changes you may want to intentionally have your code break so that you're aware of it.  That's the only idea besides premature optimization that I can use to justify this approach...<br /><br /><span style="color: rgb(51, 51, 255);font-size:180%;" >}</span></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>falco348</div>
<div class='content'>
Hey what a great site keep up the work its excellent.<BR/><A HREF="http://jarre.at/arbeitsschutz_unfallverhuetung.html" REL="nofollow">&raquo;</A></div>
</div>
</div>
