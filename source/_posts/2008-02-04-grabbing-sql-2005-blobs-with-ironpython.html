---
layout: post
title: "Grabbing SQL 2005 Blobs with IronPython"
date: 2008-02-04T22:00:00-08:00
---

<div class='post'>
<h1><font color="#0000ff">{</font></h1> <p>On Saturday I needed to grab some blob data and create files out of it. The following was some Python I used, inspired very much by this code.</p> <p>The biggest point of interest is the strongly typed array, which in IronPython is simple once you know how: using Array.CreateInstance.</p> <p>&nbsp;</p> <p>&nbsp;</p><pre>#GET IMAGES FROM IMAGE BINARY FIELD<br /># 02/02/2008 - David - @THE COMMAND CENTRE<br /><br />import clr<br />clr.AddReference("System.Data")<br />from System import *<br />from System.Data import *<br />from System.Data.SqlClient import *<br />from System.IO import *<br /><br />CONNECT = "Data Source=(local)\sqlexpress;Initial Catalog=DATABASE;Integrated Security=SSPI"<br /><br />sql = "select ID_FIELD, BLOB_FIELD from product_set"<br />cn = SqlConnection(CONNECT)<br />cn.Open()<br />cmd = SqlCommand(sql, cn)<br />reader = cmd.ExecuteReader(CommandBehavior.CloseConnection)<br />buffSize = 100<br />buff = Array.CreateInstance(Byte, buffSize)<br />recCounter = 0<br />while reader.Read():<br />	print "Creating " + str(reader[0])<br />	fs = FileStream(str(reader[0]) + str(recCounter) + "_diagram.png", FileMode.OpenOrCreate, FileAccess.Write)<br />	bw = BinaryWriter(fs)<br />	if(reader[1] != DBNull.Value):<br />		posit = 0<br />		b = reader.GetBytes(1, posit, buff, 0, buffSize)		<br />		while(b == buffSize):<br />			bw.Write(buff)<br />			bw.Flush()<br />			posit = posit + buffSize<br />			b = reader.GetBytes(1, posit, buff, 0, buffSize)		<br />		bw.Write(buff, 0, b)<br />		bw.Flush()<br />		bw.Close()<br />		fs.Close()<br />	recCounter = recCounter + 1<br /><br />reader.Close()</pre><pre><br /></pre><br /><p>I'd like to clean it up a bit, but I've written about <em>5,000,000 things</em> that I "intend" to clean up before posting and they're never posted.</p><br /><h1><font color="#0000ff">}</font></h1>  </div>
