---
layout: post
title: "Using IronPython For Converters in Silverlight"
date: 2009-04-24T04:22:00-07:00
---

<div class='post'>
<h1><font color="#0000ff">{</font></h1>  <p>&#160;</p>  <p>Tim Heuer has a <a href="http://timheuer.com/blog/archive/2008/07/30/format-data-in-silverlight-databinding-valueconverter.aspx">great intro post</a> on Silverlight data binding and value converters. The concept is a really nice one but I’m not wild about having to write a class that implements the IValueConverter interface every time I need some ad-hoc tweaking of the values I get from being data bound and how I’d like to use them within XAML. What set me off this track was a case where I simply needed to invert a boolean – what should just be “not myvalue” ended up requiring a class, an interface, and so on.</p>  <p>Dynamic languages excel at this sort of thing and since they support the ability to evaluate code on the fly I thought it would make sense to write a single implementation of IValueConverter and host Python inside of it to evaluate binding expressions that are passed in. Here is what that might look like: </p>  <pre style="padding-bottom: 10px; line-height: 120%; margin: 1em 0px; padding-left: 10px; padding-right: 10px; font-family: courier; background: #000; color: #eee; font-size: 12pt; overflow: auto; padding-top: 10px" class="brush: csharp;">public class PythonExpConverter : IValueConverter<br />    {<br />        private ScriptEngine _engine;<br /><br />        public PythonExpConverter()<br />        {<br />	   <span style="color: orange"><br />            ScriptRuntimeSetup setup = Python.CreateRuntimeSetup(null);<br />            setup.DebugMode = true;<br />            var runtime = new ScriptRuntime(setup);<br />            _engine = Python.GetEngine(runtime);<br /> 	    </span><br />        }<br /><br />        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)<br />        {<br />            object result;<br />            string python = parameter.ToString()<br />                                .Replace(&quot;value&quot;, value.ToString());<br />            try<br />            {<br />                <span style="color: orange">result = _engine.Execute(python);</span><br />            }<br />            catch (Exception ex)<br />            {<br />                // pass, just use original value<br />                result = value;<br />            }<br />            return result;<br />        }<br /><br />        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)<br />        {<br />            // same concept as above<br />            return value;<br />        }<br />    }</pre><br /><br /><p>No magic, just instantiate the Python runtime and then proceed to leverage it in the Convert phase by taking a string as the parameter for the conversion method. Use value as a keyword in your Python expression to get at the value of the underlying data.&#160; Once this is added as a static resource, you can leverage it in many ways. For example, if I had a class “Person”:</p><br /><br /><pre style="padding-bottom: 10px; line-height: 120%; margin: 1em 0px; padding-left: 10px; padding-right: 10px; font-family: courier; background: #000; color: #eee; font-size: 12pt; overflow: auto; padding-top: 10px" class="brush: csharp;">public class Person<br />    {<br />        public string FirstName { get; set; }<br />        public string LastName { get; set; }<br />        public bool OnVacation { get; set; }<br />        public double Balance { get; set; }<br />    }</pre><br /><br /><p>Let’s say I’m binding to an instance of Person (yeah, very contrived) with the following template conversions: <br />  <br />1. Uppercase last name. <br /><br />  <br />2. If OnVacation is true, disable a link to their schedule. <br /><br />  <br />3. Format balance using some currency specific format. <br /><br />  <br />Here is the XAML that leverages my single converter for all of the above:</p><br /><br /><pre style="padding-bottom: 10px; line-height: 120%; margin: 1em 0px; padding-left: 10px; padding-right: 10px; font-family: courier; background: #000; color: #eee; font-size: 12pt; overflow: auto; padding-top: 10px" class="brush: xml;">&lt;StackPanel Orientation=&quot;Vertical&quot;&gt;<br />            &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;<br />                &lt;TextBlock Text=&quot;First Name&quot; Width=&quot;100&quot; /&gt;<br />                &lt;TextBlock Text=&quot;Last Name&quot; Width=&quot;100&quot; /&gt;<br />                &lt;TextBlock Text=&quot;Is Active&quot; Width=&quot;100&quot; /&gt;<br />                &lt;TextBlock Text=&quot;Rating&quot; Width=&quot;100&quot; /&gt;<br />            &lt;/StackPanel&gt;<br />            &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;<br />                &lt;TextBlock Text=&quot;{Binding FirstName}&quot; Width=&quot;100&quot; /&gt;<br />                &lt;TextBlock <span style="color: orange">Text=&quot;{Binding LastName, Converter={StaticResource PythonExpConverter}, ConverterParameter=\'value\'.upper()}&quot;</span> Width=&quot;100&quot; /&gt;<br />                &lt;HyperlinkButton Width=&quot;100&quot; NavigateUri=&quot;http://foo&quot; Content=&quot;View&quot; <br />                        <span style="color: orange">IsEnabled=&quot;{Binding OnVacation, Converter={StaticResource PythonExpConverter}, ConverterParameter=not value}&quot;</span> /&gt;<br />                &lt;TextBlock <span style="color: orange">Text=&quot;{Binding Balance, Converter={StaticResource PythonExpConverter}, ConverterParameter=\'%2.2f\' % value}&quot;</span> Width=&quot;100&quot; /&gt;<br />            &lt;/StackPanel&gt;<br />        &lt;/StackPanel&gt;</pre><br /><br /><p>This is a very powerful approach since the limitations you hit will probably be born by a limitation in skill with Python or your dynamic language of choice rather than the approach.&#160; </p><br /><br /><h1><font color="#0000ff">}</font></h1>  </div>
